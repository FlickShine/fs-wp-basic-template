## CUSTOM
#AddType 'text/html; charset=UTF-8' html

#GoDaddy and DreamHost
<IfModule pagespeed_module>
    ModPagespeed on
    # using commands,filters etc
</IfModule>

# BEGIN Expire headers
# 1 month
<ifModule mod_expires.c>
    ExpiresActive On
    ExpiresDefault "access plus 5 seconds"
    ExpiresByType image/x-icon "access plus 2592000 seconds"
    ExpiresByType image/jpeg "access plus 2592000 seconds"
    ExpiresByType image/png "access plus 2592000 seconds"
    ExpiresByType image/gif "access plus 2592000 seconds"
    ExpiresByType application/x-shockwave-flash "access plus 2592000 seconds"
    ExpiresByType text/css "access plus 604800 seconds"
    ExpiresByType text/javascript "access plus 216000 seconds"
    ExpiresByType application/javascript "access plus 216000 seconds"
    ExpiresByType application/x-javascript "access plus 216000 seconds"
    ExpiresByType text/html "access plus 600 seconds"
    ExpiresByType application/xhtml+xml "access plus 600 seconds"
</ifModule>
# END Expire headers

# BEGIN Cache-Control Headers
<ifModule mod_headers.c>
    <filesMatch "\.(ico|jpe?g|png|gif|swf)$">
        Header set Cache-Control "public"
    </filesMatch>
    <filesMatch "\.(css)$">
        Header set Cache-Control "public"
    </filesMatch>
    <filesMatch "\.(js)$">
        Header set Cache-Control "private"
    </filesMatch>
    <filesMatch "\.(x?html?|php)$">
        Header set Cache-Control "private, must-revalidate"
    </filesMatch>
</ifModule>
# END Cache-Control Headers


### OTHER DOWN


# BEGIN iThemes Security
    # BEGIN Tweaks
        # Rules to block access to WordPress specific files
        <files .htaccess>
            Order allow,deny
            Deny from all
        </files>
        <files readme.html>
            Order allow,deny
            Deny from all
        </files>
        <files readme.txt>
            Order allow,deny
            Deny from all
        </files>
        <files install.php>
            Order allow,deny
            Deny from all
        </files>
        <files wp-config.php>
            Order allow,deny
            Deny from all
        </files>
        
        # Rules to disable XML-RPC
        <files xmlrpc.php>
            Order allow,deny
            Deny from all
        </files>
        
        # Rules to disable directory browsing
        Options -Indexes
        
        <IfModule mod_rewrite.c>
            RewriteEngine On
        
            # Rules to protect wp-includes
            RewriteRule ^wp-admin/includes/ - [F]
            RewriteRule !^wp-includes/ - [S=3]
            RewriteCond %{SCRIPT_FILENAME} !^(.*)wp-includes/ms-files.php
            RewriteRule ^wp-includes/[^/]+\.php$ - [F]
            RewriteRule ^wp-includes/js/tinymce/langs/.+\.php - [F]
            RewriteRule ^wp-includes/theme-compat/ - [F]
        
            # Rules to prevent php execution in uploads
            RewriteRule ^(.*)/uploads/(.*).php(.?) - [F]
        
            # Rules to block unneeded HTTP methods
            RewriteCond %{REQUEST_METHOD} ^(TRACE|DELETE|TRACK) [NC]
            RewriteRule ^(.*)$ - [F]
        
            # Rules to block suspicious URIs
            RewriteCond %{QUERY_STRING} \.\.\/ [NC,OR]
            RewriteCond %{QUERY_STRING} ^.*\.(bash|git|hg|log|svn|swp|cvs) [NC,OR]
            RewriteCond %{QUERY_STRING} etc/passwd [NC,OR]
            RewriteCond %{QUERY_STRING} boot\.ini [NC,OR]
            RewriteCond %{QUERY_STRING} ftp\:  [NC,OR]
            RewriteCond %{QUERY_STRING} http\:  [NC,OR]
            RewriteCond %{QUERY_STRING} https\:  [NC,OR]
            RewriteCond %{QUERY_STRING} (\<|%3C).*script.*(\>|%3E) [NC,OR]
            RewriteCond %{QUERY_STRING} mosConfig_[a-zA-Z_]{1,21}(=|%3D) [NC,OR]
            RewriteCond %{QUERY_STRING} base64_encode.*\(.*\) [NC,OR]
            RewriteCond %{QUERY_STRING} ^.*(%24&x).* [NC,OR]
            RewriteCond %{QUERY_STRING} ^.*(127\.0).* [NC,OR]
            RewriteCond %{QUERY_STRING} ^.*(globals|encode|localhost|loopback).* [NC,OR]
            RewriteCond %{QUERY_STRING} ^.*(request|concat|insert|union|declare).* [NC]
            RewriteCond %{QUERY_STRING} !^loggedout=true
            RewriteCond %{QUERY_STRING} !^action=jetpack-sso
            RewriteCond %{QUERY_STRING} !^action=rp
            RewriteCond %{HTTP_COOKIE} !^.*wordpress_logged_in_.*$
            RewriteCond %{HTTP_REFERER} !^http://maps\.googleapis\.com(.*)$
            RewriteRule ^(.*)$ - [F]
        
            # Rules to block foreign characters in URLs
            RewriteCond %{QUERY_STRING} ^.*(%0|%A|%B|%C|%D|%E|%F).* [NC]
            RewriteRule ^(.*)$ - [F]
        
            # Rules to help reduce spam
            RewriteCond %{REQUEST_METHOD} POST
            RewriteCond %{REQUEST_URI} ^(.*)wp-comments-post\.php*
            RewriteCond %{HTTP_REFERER} !^(.*)sohonycbarbers.com.* 
            RewriteCond %{HTTP_REFERER} !^http://jetpack\.wordpress\.com/jetpack-comment/ [OR]
            RewriteCond %{HTTP_USER_AGENT} ^$
            RewriteRule ^(.*)$ - [F]
        </IfModule>
    # END Tweaks
# END iThemes Security

# BEGIN WordPress
<IfModule mod_rewrite.c>
RewriteEngine On
RewriteBase /
RewriteRule ^index\.php$ - [L]
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule . /index.php [L]
</IfModule>
# END WordPress

# BEGIN W3TC Browser Cache
<IfModule mod_deflate.c>
    <IfModule mod_headers.c>
        Header append Vary User-Agent env=!dont-vary
    </IfModule>
        AddOutputFilterByType DEFLATE text/css text/x-component application/x-javascript application/javascript text/javascript text/x-js text/html text/richtext image/svg+xml text/plain text/xsd text/xsl text/xml image/x-icon application/json
    <IfModule mod_mime.c>
        # DEFLATE by extension
        AddOutputFilter DEFLATE js css htm html xml
    </IfModule>
</IfModule>
# END W3TC Browser Cache

# BEGIN W3TC CDN
<FilesMatch "\.(ttf|ttc|otf|eot|woff|font.css)$">
<IfModule mod_headers.c>
    Header set Access-Control-Allow-Origin "*"
</IfModule>
</FilesMatch>
# END W3TC CDN

# BEGIN W3TC Page Cache core
<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteBase /
    RewriteRule ^(.*\/)?w3tc_rewrite_test/?$ $1?w3tc_rewrite_test=1 [L]
    RewriteCond %{HTTP:Accept-Encoding} gzip
    RewriteRule .* - [E=W3TC_ENC:_gzip]
    RewriteCond %{HTTP_COOKIE} w3tc_preview [NC]
    RewriteRule .* - [E=W3TC_PREVIEW:_preview]
    RewriteCond %{REQUEST_METHOD} !=POST
    RewriteCond %{QUERY_STRING} =""
    RewriteCond %{HTTP_COOKIE} !(comment_author|wp\-postpass|w3tc_logged_out|wordpress_logged_in|wptouch_switch_toggle) [NC]
    RewriteCond "%{DOCUMENT_ROOT}/wp-content/cache/page_enhanced/%{HTTP_HOST}/%{REQUEST_URI}/_index%{ENV:W3TC_PREVIEW}.html%{ENV:W3TC_ENC}" -f
    RewriteRule .* "/wp-content/cache/page_enhanced/%{HTTP_HOST}/%{REQUEST_URI}/_index%{ENV:W3TC_PREVIEW}.html%{ENV:W3TC_ENC}" [L]
</IfModule>
# END W3TC Page Cache core
